{
  "description": "Create a Vagrant box file from the Cumulus Linux virtual machine appliance",
  "variables": {
    "source": "CumulusLinux-2.5.3.ova",
    "name": "cumulus-vx-2.5.3",
    "intnet": "intnet"
  },
  "builders": [
    {
      "type": "virtualbox-ovf",
      "source_path": "{{user `source`}}",
      "vm_name": "{{user `name`}}",
      "vboxmanage": [
        ["modifyvm", "{{.Name}}", "--memory", "512"],
        ["modifyvm", "{{.Name}}", "--nic1", "nat"],
        ["modifyvm", "{{.Name}}", "--nic2", "{{user `intnet`}}"],
        ["modifyvm", "{{.Name}}", "--nic3", "{{user `intnet`}}"],
        ["modifyvm", "{{.Name}}", "--nic4", "{{user `intnet`}}"]
      ],
      "vboxmanage_post": [
        ["modifyvm", "{{.Name}}", "--ostype", "Linux"]
      ],
      "headless": true,
      "ssh_username": "cumulus",
      "ssh_password": "cn321",
      "ssh_wait_timeout": "20s",
      "shutdown_command": "sudo -S shutdown -h now"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "script": "scripts/setup.sh",
      "execute_command": "chmod +x {{ .Path }};sudo {{ .Vars }} {{ .Path }}" 
    }
  ],
  "post-processors": [
    {
      "type": "vagrant",
      "output": "{{user `name`}}.box"
    }
  ]
}
